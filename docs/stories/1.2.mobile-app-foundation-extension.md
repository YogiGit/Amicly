# Story 1.2: Mobile App Foundation Extension

<!-- Powered by BMADâ„¢ Core -->

## Status
Draft

## Story
**As a** developer,
**I want** to extend the ReferenceApp-Expo mobile app with conversation UI foundation,
**so that** I can build AI conversation features while maintaining the existing six-theme design system and Z-component patterns.

## Acceptance Criteria
1. Add conversation screen using Z-component library patterns (ZText, ZButton, ZHeader)
2. Integrate AI conversation state management with existing Redux patterns and theme management
3. Create conversation UI components (message bubbles, input, voice controls) that work across all six themes
4. Maintain ReferenceApp-Expo design system (six-theme architecture, #FF4D67 primary colors, Urbanist typography with all weights)
5. Ensure conversation components support theme switching with live preview functionality

## Tasks / Subtasks
- [ ] Create conversation screen foundation (AC: 1)
  - [ ] Add ConversationScreen component using Z-component patterns
  - [ ] Implement screen header with ZHeader component
  - [ ] Add navigation integration with React Navigation v6
  - [ ] Create conversation container with proper theme support
- [ ] Integrate conversation state management (AC: 2)
  - [ ] Extend existing Redux store with conversation slice
  - [ ] Add conversation actions and reducers following Redux Toolkit patterns
  - [ ] Integrate with existing theme management system
  - [ ] Add RTK Query setup for future API integration
- [ ] Build conversation UI components (AC: 3)
  - [ ] Create MessageBubble component with theme support
  - [ ] Build conversation input component with ZButton integration
  - [ ] Add voice recording controls using existing patterns
  - [ ] Implement conversation history list with proper scrolling
- [ ] Maintain ReferenceApp-Expo design system (AC: 4)
  - [ ] Verify all six themes work with new conversation components
  - [ ] Ensure #FF4D67 primary color usage throughout conversation UI
  - [ ] Validate Urbanist typography (Regular, Medium, SemiBold, Bold) integration
  - [ ] Test responsive scaling with moderateScale across all themes
- [ ] Implement theme switching support (AC: 5)
  - [ ] Add live theme preview for conversation components
  - [ ] Ensure conversation state persists through theme changes
  - [ ] Test theme switching performance with conversation history
  - [ ] Validate theme persistence through AsyncStorage

## Dev Notes

### Previous Story Insights
From Story 1.1: Complete development environment setup with React Native 0.81.4 + Expo SDK ~54.0.10, Redux Toolkit + RTK Query state management, and six-theme architecture foundation established. All Z-components (ZText, ZButton) are working with theme integration.

### Tech Stack Requirements
[Source: architecture/tech-stack.md]
- **Frontend:** React Native 0.81.4 with Expo SDK ~54.0.10, TypeScript ~5.9.2
- **UI Components:** ReferenceApp-Expo Z-Components with six-theme architecture
- **State Management:** Redux Toolkit + RTK Query ^2.9.0 (already established in Story 1.1)
- **Design System:** Six themes, #FF4D67 primary color, Urbanist typography
- **Navigation:** React Navigation v6 ^7.1.17
- **Styling:** Styled Components with existing theme integration

### Project Structure Context
[Source: architecture/source-tree.md]
Key file locations for this story:
- `/apps/mobile/src/screens/chat/` - ConversationScreen and related conversation screens
- `/apps/mobile/src/components/conversation/` - ConversationView, MessageBubble, VoiceButton
- `/apps/mobile/src/stores/conversation/` - Chat history, AI state, voice processing Redux slices
- `/apps/mobile/src/services/conversation/` - Future API integration setup
- `/apps/mobile/src/navigation/` - Navigation integration for conversation flows

### Existing ReferenceApp-Expo Foundation
Building on established patterns from Story 1.1:
- Six-theme system: Classic Light, Ocean Breeze, Golden Hour, Classic Dark, Midnight Blue, Royal Purple
- Z-component library: ZText, ZButton, ZHeader with theme integration
- Redux store with theme management and AsyncStorage persistence
- Theme switching with live preview functionality
- Responsive scaling with moderateScale function

### Conversation Component Requirements
- **MessageBubble:** Support sent/received states, theme colors, typography hierarchy
- **ConversationInput:** Integrate with ZButton, support voice recording, theme-aware styling
- **ConversationScreen:** Use ZHeader patterns, proper navigation, theme switching support
- **Voice Controls:** Follow existing button patterns, integrate with device permissions

### Theme Integration Requirements
All conversation components must:
- Support all six theme variations without code changes
- Use theme colors for backgrounds, text, and accent elements
- Maintain readability and accessibility across all themes
- Preserve theme selection through AsyncStorage
- Support live theme switching without losing conversation state

### Performance Requirements
- Conversation history must scroll smoothly with 100+ messages
- Theme switching must be instant (<100ms) for conversation components
- Component rendering must not impact existing ReferenceApp performance
- Message bubble rendering must support rapid conversation flows

### Testing Standards
[Source: architecture/testing-strategy.md]
- **Component Tests:** Located in `apps/mobile/tests/components/conversation/`
- **Screen Tests:** ConversationScreen.test.tsx with theme switching validation
- **Theme Tests:** All six themes must be tested for each conversation component
- **Integration Tests:** Conversation state management with Redux store
- **Storybook Integration:** All conversation components must have Storybook stories

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-11-02 | 1.0 | Initial story creation for Mobile App Foundation Extension | Sarah (Product Owner) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be populated during implementation*

### Debug Log References
*To be populated during implementation*

### Completion Notes List
*To be populated during implementation*

### File List
*To be populated during implementation*

## QA Results
*Results from QA Agent review will be populated here*